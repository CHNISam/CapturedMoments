(()=>{"use strict";var e={185:(e,t,a)=>{async function o(e,t,a=1e5){const o=new TextEncoder,n=await crypto.subtle.importKey("raw",o.encode(e),{name:"PBKDF2"},!1,["deriveBits"]),l=await crypto.subtle.deriveBits({name:"PBKDF2",salt:o.encode(t),iterations:a,hash:"SHA-256"},n,256);return Array.from(new Uint8Array(l)).map((e=>e.toString(16).padStart(2,"0"))).join("")}a.d(t,{wN:()=>o})},468:(e,t,a)=>{a.d(t,{k:()=>n});var o=a(810);const n=(0,o.nY)("user",{state:()=>({currentUser:localStorage.getItem("cm_currentUser")||null,avatarMap:JSON.parse(localStorage.getItem("cm_avatarMap")||"{}")}),getters:{isLoggedIn:e=>!!e.currentUser,getAvatar:e=>t=>{const a=e.avatarMap[t];return a&&a.length>0?a:"https://placehold.co/60"}},actions:{login(e){console.log("🔥 userStore.login called with",e),this.currentUser=e,localStorage.setItem("cm_currentUser",e)},logout(){this.currentUser=null,localStorage.removeItem("cm_currentUser")},setAvatar(e,t){this.avatarMap={...this.avatarMap,[e]:t},localStorage.setItem("cm_avatarMap",JSON.stringify(this.avatarMap))}}})},670:(e,t,a)=>{var o=a(810),n=a(751),l=a(641);function r(e,t,a,o,n,r){const s=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.Wv)(s)}const s={name:"App"};var i=a(262);const u=(0,i.A)(s,[["render",r]]),c=u;var d=a(33),p=a(468),m=a(953),v=a(220);const h={class:"app-header"},g={class:"header-left"},k={class:"header-right"},b=["src"],f={class:"nav-dropdown"},y={__name:"HeaderNav",props:{title:{type:String,required:!0},avatar:{type:String,required:!0}},emits:["toggle-sidebar","refresh","search","post","notify","ai","settings"],setup(e,{emit:t}){const a=t,o=(0,m.KR)(""),r=(0,m.KR)(!1);function s(){a("search",o.value)}const i=(0,p.k)(),u=(0,v.rd)();function c(){i.logout(),u.push({name:"Login"})}function y(){r.value=!1,u.push("/settings")}return(t,a)=>((0,l.uX)(),(0,l.CE)("header",h,[(0,l.Lk)("div",g,[(0,l.Lk)("button",{class:"icon-btn hamburger",onClick:a[0]||(a[0]=e=>t.$emit("toggle-sidebar")),"aria-label":"切换侧栏"},a[9]||(a[9]=[(0,l.Lk)("svg",{viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{d:"M4 6h16M4 12h16M4 18h16"})],-1)])),(0,l.Lk)("span",{class:"logo",onClick:a[1]||(a[1]=e=>t.$emit("refresh"))},(0,d.v_)(e.title),1),(0,l.Lk)("button",{class:"icon-btn home-btn",onClick:a[2]||(a[2]=e=>t.$emit("refresh")),"aria-label":"主页"},a[10]||(a[10]=[(0,l.Lk)("svg",{viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{d:"M3 12l9-9 9 9M4 10v10h6v-6h4v6h6V10"})],-1)]))]),(0,l.Lk)("form",{class:"header-center search-form",onSubmit:(0,n.D$)(s,["prevent"])},[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>o.value=e),class:"search-input",placeholder:"Search…","aria-label":"搜索"},null,512),[[n.Jo,o.value]]),a[11]||(a[11]=(0,l.Lk)("button",{type:"submit",class:"icon-btn","aria-label":"搜索"},[(0,l.Lk)("svg",{viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("circle",{cx:"11",cy:"11",r:"8"}),(0,l.Lk)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})])],-1))],32),(0,l.Lk)("div",k,[(0,l.Lk)("button",{class:"icon-btn",onClick:a[4]||(a[4]=e=>t.$emit("post")),"aria-label":"投稿"},a[12]||(a[12]=[(0,l.Lk)("svg",{viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{d:"M12 4v16M20 12H4"})],-1)])),(0,l.Lk)("button",{class:"icon-btn",onClick:a[5]||(a[5]=e=>t.$emit("notify")),"aria-label":"通知"},a[13]||(a[13]=[(0,l.Lk)("svg",{viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0 1 18 14.158V11\n                   a6 6 0 0 0-5-5.917V5\n                   a2 2 0 1 0-4 0v.083\n                   A6 6 0 0 0 4 11v3.159\n                   c0 .538-.214 1.055-.595 1.436L2 17h5"}),(0,l.Lk)("path",{d:"M12 21a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2z"})],-1)])),(0,l.Lk)("button",{class:"icon-btn",onClick:a[6]||(a[6]=e=>t.$emit("ai")),"aria-label":"AI 助手"},a[14]||(a[14]=[(0,l.Fv)('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FFF" stroke-width="2.5" data-v-d00109d0><path d="M8 16l4-8 4 8" data-v-d00109d0></path><path d="M9 16.5l4-8 4 8" stroke-opacity=".2" data-v-d00109d0></path><line x1="10" y1="12" x2="14" y2="12" data-v-d00109d0></line><line x1="17" y1="8" x2="17" y2="16" data-v-d00109d0></line><line x1="17.6" y1="8.6" x2="17.6" y2="16.6" stroke-opacity=".2" data-v-d00109d0></line></svg>',1)])),(0,l.Lk)("div",{class:"nav-avatar",onMouseenter:a[7]||(a[7]=e=>r.value=!0),onMouseleave:a[8]||(a[8]=e=>r.value=!1)},[(0,l.Lk)("img",{src:e.avatar,class:"avatar-img",alt:"avatar"},null,8,b),(0,l.bF)(n.eB,{name:"dropdown-fade"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.Lk)("div",f,[(0,l.Lk)("button",{class:"dropdown-item",onClick:y},"设置"),a[15]||(a[15]=(0,l.Lk)("div",{class:"dropdown-divider"},null,-1)),(0,l.Lk)("button",{class:"dropdown-item",onClick:c}," 退出 ")],512),[[n.aG,r.value]])])),_:1})],32)])]))}},_=(0,i.A)(y,[["__scopeId","data-v-d00109d0"]]),L=_,C={viewBox:"0 0 24 24",class:"icon"},w={__name:"AlbumIcon",setup(e){return(e,t)=>((0,l.uX)(),(0,l.CE)("svg",C,t[0]||(t[0]=[(0,l.Lk)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor",fill:"none","stroke-width":"2"},null,-1),(0,l.Lk)("circle",{cx:"9",cy:"9",r:"2",stroke:"currentColor",fill:"none","stroke-width":"2"},null,-1),(0,l.Lk)("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",fill:"none","stroke-width":"2"},null,-1)])))}},x=(0,i.A)(w,[["__scopeId","data-v-78572ae1"]]),I=x,S={viewBox:"0 0 24 24",class:"icon"},E={__name:"HomeIcon",setup(e){return(e,t)=>((0,l.uX)(),(0,l.CE)("svg",S,t[0]||(t[0]=[(0,l.Lk)("path",{d:"M3 12l9-9 9 9M4 10v10h6v-6h4v6h6V10",stroke:"currentColor",fill:"none","stroke-width":"2"},null,-1)])))}},M=(0,i.A)(E,[["__scopeId","data-v-0410df9a"]]),A=M,X={viewBox:"0 0 24 24",class:"icon"},B={__name:"MomentsIcon",setup(e){return(e,t)=>((0,l.uX)(),(0,l.CE)("svg",X,t[0]||(t[0]=[(0,l.Lk)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",ry:"2",stroke:"currentColor",fill:"none","stroke-width":"2"},null,-1),(0,l.Lk)("path",{d:"M7 8h10M7 12h8M7 16h6",stroke:"currentColor",fill:"none","stroke-width":"2"},null,-1)])))}},F=(0,i.A)(B,[["__scopeId","data-v-bf6083b8"]]),V=F,$={viewBox:"0 0 24 24",class:"icon"},N={__name:"PostIcon",setup(e){return(e,t)=>((0,l.uX)(),(0,l.CE)("svg",$,t[0]||(t[0]=[(0,l.Lk)("path",{d:"M12 4v16M20 12H4",stroke:"currentColor",fill:"none","stroke-width":"2"},null,-1)])))}},W=(0,i.A)(N,[["__scopeId","data-v-c2a4305c"]]),O=W,R={__name:"Icon",props:{name:{type:String,required:!0}},setup(e){const t=e,a={home:A,moments:V,albums:I,post:O},o=(0,l.EW)((()=>a[t.name]||null));return(e,t)=>o.value?((0,l.uX)(),(0,l.Wv)((0,l.$y)(o.value),{key:0})):(0,l.Q3)("",!0)}},U=R,z=U,T={__name:"NavItem",props:{to:{type:String,required:!0},icon:{type:String,required:!0},label:{type:String,required:!0}},setup(e){const t=e,a=(0,v.rd)(),o=(0,v.lq)(),n=(0,l.EW)((()=>o.path===t.to));function r(){o.path!==t.to&&a.push(t.to)}return(t,a)=>((0,l.uX)(),(0,l.CE)("button",{class:(0,d.C4)(["nav-item",{active:n.value}]),onClick:r},[(0,l.bF)(z,{name:e.icon},null,8,["name"]),(0,l.Lk)("span",null,(0,d.v_)(e.label),1)],2))}},D=(0,i.A)(T,[["__scopeId","data-v-4466c212"]]),K=D,q={__name:"SideBar",props:{collapsed:{type:Boolean,default:!1}},setup(e){return(t,a)=>((0,l.uX)(),(0,l.CE)("aside",{class:(0,d.C4)(["app-sidebar",{collapsed:e.collapsed}])},[(0,l.bF)(K,{to:"/",icon:"home",label:"首页"}),(0,l.bF)(K,{to:"/moments",icon:"moments",label:"动态"}),(0,l.bF)(K,{to:"/albums",icon:"albums",label:"相册"}),(0,l.bF)(K,{to:"/editor",icon:"post",label:"投稿"})],2))}},P=(0,i.A)(q,[["__scopeId","data-v-74dcf506"]]),j=P,H={class:"shell"},Q={class:"body"},G={__name:"ShellLayout",setup(e){const t=(0,m.KR)(!0);function a(){window.location.reload()}function o(e){console.log("搜索",e)}return(e,n)=>{const r=(0,l.g2)("HeaderRightStuff"),s=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",H,[(0,l.bF)(L,{onToggleSidebar:n[0]||(n[0]=e=>t.value=!t.value),onRefresh:a,onSearch:o},{"right-extra":(0,l.k6)((()=>[(0,l.bF)(r)])),_:1}),(0,l.Lk)("div",Q,[(0,l.bF)(j,{collapsed:!t.value},null,8,["collapsed"]),(0,l.Lk)("main",{class:(0,d.C4)(["app-main",{"sidebar-collapsed":!t.value}])},[(0,l.bF)(s)],2)])])}}},J=(0,i.A)(G,[["__scopeId","data-v-71986a3f"]]),Z=J,Y={class:"albums-page"},ee={class:"upload-area"},te={class:"upload-label"},ae={key:0,class:"photo-grid"},oe=["onClick"],ne=["src"],le={key:1,class:"empty-state"};function re(e,t,a,o,n,r){const s=(0,l.g2)("ImageSliderModal");return(0,l.uX)(),(0,l.CE)("div",Y,[t[4]||(t[4]=(0,l.Lk)("h2",{class:"page-title"},"相册 (本地上传测试)",-1)),(0,l.Lk)("div",ee,[(0,l.Lk)("label",te,[t[2]||(t[2]=(0,l.Lk)("svg",{class:"icon upload-icon",viewBox:"0 0 24 24"},[(0,l.Lk)("path",{d:"M12 5v14m7-7H5"})],-1)),t[3]||(t[3]=(0,l.eW)(" 选择本地照片 ")),(0,l.Lk)("input",{type:"file",accept:"image/*",multiple:"",onChange:t[0]||(t[0]=(...e)=>r.onFileChange&&r.onFileChange(...e))},null,32)])]),n.photos.length?((0,l.uX)(),(0,l.CE)("div",ae,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.photos,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"photo-item",onClick:e=>r.openSlider(t)},[(0,l.Lk)("img",{src:e,alt:"photo",class:"photo-thumb"},null,8,ne)],8,oe)))),128))])):((0,l.uX)(),(0,l.CE)("div",le,"暂无照片，快去上传吧~")),(0,l.bF)(s,{images:n.photos,"initial-index":n.sliderIndex,visible:n.sliderVisible,"onUpdate:visible":t[1]||(t[1]=e=>n.sliderVisible=e),onDeleteImage:r.onDeleteImage},null,8,["images","initial-index","visible","onDeleteImage"])])}const se={class:"slider-box"},ie=["aria-label"],ue={key:0,class:"options-panel"},ce={class:"slider-content"},de=["disabled"],pe=["src"],me=["disabled"],ve={class:"zoom-control"},he=["min","max"],ge={key:0,class:"info-panel"},ke={class:"meta"};function be(e,t,a,o,r,s){return a.visible?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"overlay",onClick:t[10]||(t[10]=(0,n.D$)(((...e)=>s.close&&s.close(...e)),["self"]))},[(0,l.Lk)("div",se,[(0,l.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>s.close&&s.close(...e))},"×"),(0,l.Lk)("button",{class:"more-btn",onClick:t[1]||(t[1]=(...e)=>s.toggleOptions&&s.toggleOptions(...e))},"⋯"),(0,l.Lk)("button",{class:"info-btn",onClick:t[2]||(t[2]=(...e)=>s.toggleInfo&&s.toggleInfo(...e)),"aria-label":r.infoVisible?"收起信息":"查看信息"},t[11]||(t[11]=[(0,l.Lk)("svg",{viewBox:"0 0 24 24",class:"icon"},[(0,l.Lk)("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor","stroke-width":"2"}),(0,l.Lk)("line",{x1:"12",y1:"8",x2:"12",y2:"8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}),(0,l.Lk)("line",{x1:"12",y1:"11",x2:"12",y2:"16",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,ie),(0,l.bF)(n.eB,{name:"options-pop"},{default:(0,l.k6)((()=>[r.optionsVisible?((0,l.uX)(),(0,l.CE)("div",ue,[(0,l.Lk)("button",{class:"option",onClick:t[3]||(t[3]=t=>e.$emit("delete-image",r.currentIndex))},"删除")])):(0,l.Q3)("",!0)])),_:1}),(0,l.Lk)("div",ce,[(0,l.Lk)("button",{class:"nav-btn left",onClick:t[4]||(t[4]=(...e)=>s.prev&&s.prev(...e)),disabled:r.currentIndex<=0},"‹",8,de),(0,l.Lk)("img",{ref:"slideImg",class:"slide-img",src:a.images[r.currentIndex],onLoad:t[5]||(t[5]=(...e)=>s.updateSize&&s.updateSize(...e)),style:(0,d.Tr)({transform:`scale(${r.zoom})`,transition:"transform .15s"}),onWheel:t[6]||(t[6]=(0,n.D$)(((...e)=>s.onWheel&&s.onWheel(...e)),["prevent"]))},null,44,pe),(0,l.Lk)("button",{class:"nav-btn right",onClick:t[7]||(t[7]=(...e)=>s.next&&s.next(...e)),disabled:r.currentIndex>=a.images.length-1},"›",8,me)]),(0,l.Lk)("button",{class:"delete-btn",onClick:t[8]||(t[8]=t=>e.$emit("delete-image",r.currentIndex))},t[12]||(t[12]=[(0,l.Lk)("svg",{viewBox:"0 0 24 24",class:"icon"},[(0,l.Lk)("path",{d:"M3 6h18M9 6v12m6-12v12M4 6v14a2 2 0 002 2h12a2 2 0 002-2V6"})],-1)])),(0,l.Lk)("div",ve,[t[13]||(t[13]=(0,l.Lk)("svg",{class:"icon zoom-icon",viewBox:"0 0 24 24"},[(0,l.Lk)("circle",{cx:"11",cy:"11",r:"8"}),(0,l.Lk)("line",{x1:"16",y1:"16",x2:"22",y2:"22"})],-1)),(0,l.bo)((0,l.Lk)("input",{type:"range",min:r.minZoom,max:r.maxZoom,step:"0.1","onUpdate:modelValue":t[9]||(t[9]=e=>r.zoom=e)},null,8,he),[[n.Jo,r.zoom,void 0,{number:!0}]])]),(0,l.bF)(n.eB,{name:"sidebar-slide"},{default:(0,l.k6)((()=>[r.infoVisible?((0,l.uX)(),(0,l.CE)("div",ge,[(0,l.Lk)("p",null,[t[14]||(t[14]=(0,l.Lk)("b",null,"尺寸：",-1)),(0,l.eW)((0,d.v_)(r.size),1)]),(0,l.Lk)("p",null,[t[15]||(t[15]=(0,l.Lk)("b",null,"日期：",-1)),(0,l.eW)((0,d.v_)(s.formattedDate),1)])])):(0,l.Q3)("",!0)])),_:1}),(0,l.Lk)("div",ke,(0,d.v_)(r.currentIndex+1)+" / "+(0,d.v_)(a.images.length),1)])])):(0,l.Q3)("",!0)}const fe={name:"ImageSliderModal",props:{images:Array,initialIndex:Number,visible:Boolean},data(){return{currentIndex:this.initialIndex,zoom:1,minZoom:.5,maxZoom:3,optionsVisible:!1,infoVisible:!1,size:""}},computed:{formattedDate(){return(new Date).toLocaleString()}},watch:{initialIndex(e){this.currentIndex=e},currentIndex(){this.zoom=1,this.optionsVisible=!1,this.infoVisible=!1,this.updateSize()}},methods:{close(){this.$emit("update:visible",!1)},prev(){this.currentIndex>0&&this.currentIndex--},next(){this.currentIndex<this.images.length-1&&this.currentIndex++},onWheel(e){const t=e.deltaY>0?-.1:.1;this.zoom=Math.min(this.maxZoom,Math.max(this.minZoom,+(this.zoom+t).toFixed(2)))},updateSize(e){const t=e?.target||this.$refs.slideImg;t&&(this.size=`${t.naturalWidth} × ${t.naturalHeight}`)},toggleOptions(){this.optionsVisible=!this.optionsVisible},toggleInfo(){this.infoVisible=!this.infoVisible}},mounted(){this.updateSize()}},ye=(0,i.A)(fe,[["render",be],["__scopeId","data-v-05fec163"]]),_e=ye,Le={name:"AlbumsPage",components:{ImageSliderModal:_e},data(){return{photos:[],sliderVisible:!1,sliderIndex:0}},methods:{onFileChange(e){Array.from(e.target.files).forEach((e=>{this.photos.push(URL.createObjectURL(e))}))},openSlider(e){this.sliderIndex=e,this.sliderVisible=!0},onDeleteImage(e){this.photos.splice(e,1),this.photos.length?e>=this.photos.length&&(this.sliderIndex=this.photos.length-1):this.sliderVisible=!1}}},Ce=(0,i.A)(Le,[["render",re],["__scopeId","data-v-38d639a7"]]),we=Ce,xe={style:{padding:"24px"}};function Ie(e,t){return(0,l.uX)(),(0,l.CE)("h2",xe,"EditorPage 占位")}const Se={},Ee=(0,i.A)(Se,[["render",Ie]]),Me=Ee,Ae=["217122260","246490729"];function Xe(){try{const e=localStorage.getItem("allowed_uids"),t=JSON.parse(e);if(Array.isArray(t))return t}catch(e){}return Ae}var Be=a(185);const Fe={class:"error-message"},Ve={__name:"ErrorMessage",props:{message:{type:String,required:!0}},setup(e){return(t,a)=>((0,l.uX)(),(0,l.CE)("p",Fe,(0,d.v_)(e.message),1))}},$e=(0,i.A)(Ve,[["__scopeId","data-v-3425be1b"]]),Ne=$e,We=["disabled"],Oe={key:0},Re={__name:"LoginButton",props:{disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:t}){const a=e,o=t;function n(e){a.disabled||o("click",e)}return(t,a)=>((0,l.uX)(),(0,l.CE)("button",(0,l.v6)(t.$attrs,{class:"btn-atom",disabled:e.disabled,onClick:n}),[e.loading?((0,l.uX)(),(0,l.CE)("span",Oe,"请稍候...")):(0,l.RG)(t.$slots,"default",{key:1})],16,We))}},Ue=(0,i.A)(Re,[["__scopeId","data-v-0d4d6c09"]]),ze=Ue,Te={__name:"AnimatedTitle",props:{text:{type:String,required:!0},speedFirst:{type:Number,default:120},speedMid:{type:Number,default:60},speedLast:{type:Number,default:40},fadeDuration:{type:Number,default:150},pauseDuration:{type:Number,default:150}},setup(e){const t=e,a=(0,m.KR)(""),o=(0,m.KR)(!1);let r;function s(e){a.value="",o.value=!0;let n=0;function l(){if(n<e.length){a.value+=e[n++];const o=1===n?t.speedFirst:n===e.length?t.speedLast:t.speedMid;r=setTimeout(l,o)}}l()}function i(e){o.value=!1,clearTimeout(r),setTimeout((()=>s(e)),t.fadeDuration+t.pauseDuration)}return(0,l.wB)((()=>t.text),(e=>i(e)),{immediate:!0}),(e,t)=>((0,l.uX)(),(0,l.Wv)(n.eB,{name:"fade-scale"},{default:(0,l.k6)((()=>[o.value?((0,l.uX)(),(0,l.CE)("h3",(0,l.v6)({key:0,class:"animated-title"},e.$attrs),[(0,l.eW)((0,d.v_)(a.value),1),t[0]||(t[0]=(0,l.Lk)("span",{class:"typing-cursor"},null,-1))],16)):(0,l.Q3)("",!0)])),_:1}))}},De=(0,i.A)(Te,[["__scopeId","data-v-e07500f0"]]),Ke=De,qe=["value","type","placeholder","maxlength","autocomplete"],Pe={__name:"InputField",props:{modelValue:{type:String,required:!0},type:{type:String,default:"text"},placeholder:{type:String,default:""},maxlength:{type:[String,Number],default:255},autocomplete:{type:String,default:"off"},error:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=t;function o(e){a("update:modelValue",e.target.value)}return(t,a)=>((0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("input",{value:e.modelValue,type:e.type,placeholder:e.placeholder,maxlength:e.maxlength,autocomplete:e.autocomplete,onInput:o,class:(0,d.C4)(["input-field",{"has-error":e.error}])},null,42,qe)]))}},je=(0,i.A)(Pe,[["__scopeId","data-v-3ab8759a"]]),He=je,Qe={class:"form-group"},Ge={__name:"FormGroup",props:{value:{type:String,required:!0},type:{type:String,default:"text"},placeholder:{type:String,default:""},maxlength:{type:[String,Number],default:255},autocomplete:{type:String,default:"off"},errorMessage:{type:String,default:""}},emits:["update:value"],setup(e,{emit:t}){const a=t;return(t,o)=>((0,l.uX)(),(0,l.CE)("div",Qe,[(0,l.bF)(He,{modelValue:e.value,"onUpdate:modelValue":o[0]||(o[0]=e=>a("update:value",e)),type:e.type,placeholder:e.placeholder,maxlength:e.maxlength,autocomplete:e.autocomplete,error:!!e.errorMessage},null,8,["modelValue","type","placeholder","maxlength","autocomplete","error"]),e.errorMessage?((0,l.uX)(),(0,l.Wv)(Ne,{key:0,message:e.errorMessage},null,8,["message"])):(0,l.Q3)("",!0)]))}},Je=(0,i.A)(Ge,[["__scopeId","data-v-3632b377"]]),Ze=Je,Ye={class:"login-box"},et={__name:"LoginModal",props:{show:Boolean},emits:["login-success"],setup(e,{emit:t}){const a=e,o=t,r=(0,m.KR)(""),s=(0,m.KR)(""),i=(0,m.KR)("登录 Captured Moments"),u=(0,m.KR)(""),c=(0,m.KR)(!1),p=(0,m.KR)(0),v=(0,l.EW)((()=>`cred_${r.value.trim()}`)),h=(0,l.EW)((()=>(p.value,f(localStorage.getItem(v.value))))),g=(0,l.EW)((()=>""!==r.value.trim()&&!h.value)),k=(0,l.EW)((()=>{const e=r.value.trim(),t=s.value;return!!e&&t.length>=(g.value?4:1)&&!c.value})),b=(0,l.EW)((()=>u.value&&!(g.value||!h.value)));function f(e){try{return JSON.parse(e||"null")}catch{return null}}function y(e,t){if(e.length!==t.length)return!1;let a=0;for(let o=0;o<e.length;o++)a|=e.charCodeAt(o)^t.charCodeAt(o);return 0===a}function _(){return Array.from(crypto.getRandomValues(new Uint8Array(8))).map((e=>e.toString(16).padStart(2,"0"))).join("")}async function L(){if(!k.value)return;const e=r.value.trim();c.value=!0,u.value="";try{const t=Xe();if(!t.includes(e))throw new Error("用户不存在");if(h.value){const{hash:e,salt:t,iter:a=1e5}=h.value,o=await(0,Be.wN)(s.value,t,a);if(!y(o,e))throw new Error("密码不正确，请重试")}else{if(s.value.length<4)throw new Error("密码至少 4 位");const e=_(),t=await(0,Be.wN)(s.value,e);localStorage.setItem(v.value,JSON.stringify({hash:t,salt:e,iter:1e5})),p.value++}sessionStorage.setItem("currentUser",e),u.value="",o("login-success",e)}catch(t){u.value=t.message||"系统错误"}finally{c.value=!1}}return(0,l.wB)((()=>a.show),(e=>{e&&(r.value="",s.value="",u.value="",c.value=!1,p.value++)})),(0,l.wB)([r,s],(()=>{u.value&&(u.value=""),u.value=""})),(t,a)=>((0,l.uX)(),(0,l.Wv)(n.eB,{name:"fade"},{default:(0,l.k6)((()=>[e.show?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"fullpage-login",tabindex:"0",onKeyup:a[2]||(a[2]=(0,n.jR)((e=>k.value&&L()),["enter"]))},[(0,l.Lk)("div",Ye,[(0,l.bF)(Ke,{text:i.value,class:"dark-title"},null,8,["text"]),(0,l.Lk)("form",{onSubmit:(0,n.D$)(L,["prevent"]),autocomplete:"on"},[(0,l.bF)(Ze,{value:r.value,"onUpdate:value":a[0]||(a[0]=e=>r.value=e),placeholder:"请输入 UID","error-message":u.value&&!h.value?u.value:""},null,8,["value","error-message"]),(0,l.bF)(Ze,{value:s.value,"onUpdate:value":a[1]||(a[1]=e=>s.value=e),type:"password",placeholder:g.value?"首次设置密码（建议至少 4 位）":"请输入密码",autocomplete:g.value?"new-password":"current-password","error-message":u.value&&h.value?u.value:""},null,8,["value","placeholder","autocomplete","error-message"]),b.value?((0,l.uX)(),(0,l.Wv)(Ne,{key:0,message:u.value},null,8,["message"])):(0,l.Q3)("",!0),(0,l.bF)(ze,{type:"submit",disabled:!k.value,loading:c.value},{default:(0,l.k6)((()=>[(0,l.eW)((0,d.v_)(g.value?"设置并登录":"登录"),1)])),_:1},8,["disabled","loading"])],32)])],32)):(0,l.Q3)("",!0)])),_:1}))}},tt=(0,i.A)(et,[["__scopeId","data-v-d1540cee"]]),at=tt,ot={__name:"LoginPage",setup(e){const t=(0,v.rd)(),a=(0,v.lq)(),o=(0,p.k)();function n(e){o.login(e);const n=a.query.redirect||"/moments";t.replace(n)}return(e,t)=>((0,l.uX)(),(0,l.Wv)(at,{show:"",onLoginSuccess:n}))}},nt=ot,lt=nt,rt={__name:"LoadMoreButton",emits:["load"],setup(e){return(e,t)=>((0,l.uX)(),(0,l.CE)("button",{class:"btn-load-more",onClick:t[0]||(t[0]=t=>e.$emit("load"))},[(0,l.RG)(e.$slots,"default",{},(()=>[t[1]||(t[1]=(0,l.eW)("加载更多"))]))]))}},st=(0,i.A)(rt,[["__scopeId","data-v-38169860"]]),it=st,ut={class:"actions"},ct={__name:"PostActions",props:{views:Number,comments:Number},emits:["toggle-comments"],setup(e){return(t,a)=>((0,l.uX)(),(0,l.CE)("div",ut,[a[2]||(a[2]=(0,l.Lk)("svg",{viewBox:"0 0 24 24"},[(0,l.Lk)("path",{d:"M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7z m0 12a5 5 0 110-10 5 5 0 010 10z"})],-1)),(0,l.Lk)("span",null,(0,d.v_)(e.views),1),((0,l.uX)(),(0,l.CE)("svg",{viewBox:"0 0 24 24",class:"comment-btn",onClick:a[0]||(a[0]=e=>t.$emit("toggle-comments"))},a[1]||(a[1]=[(0,l.Lk)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10z",fill:"none",stroke:"currentColor","stroke-width":"2"},null,-1)]))),(0,l.Lk)("span",null,(0,d.v_)(e.comments),1)]))}},dt=(0,i.A)(ct,[["__scopeId","data-v-b469224c"]]),pt=dt,mt={class:"post-card"},vt={class:"head"},ht=["src"],gt={class:"date"},kt=["innerHTML"],bt={__name:"PostCard",props:{avatarUrl:String,author:String,time:String,content:String},setup(e){return(t,a)=>((0,l.uX)(),(0,l.CE)("article",mt,[(0,l.Lk)("header",vt,[(0,l.Lk)("img",{src:e.avatarUrl,class:"avatar"},null,8,ht),(0,l.Lk)("b",null,(0,d.v_)(e.author),1),(0,l.Lk)("small",gt,(0,d.v_)(e.time),1)]),(0,l.Lk)("section",{class:"body",innerHTML:e.content},null,8,kt),(0,l.RG)(t.$slots,"images"),(0,l.RG)(t.$slots,"actions"),(0,l.RG)(t.$slots,"comments")]))}},ft=(0,i.A)(bt,[["__scopeId","data-v-43e2250f"]]),yt=ft,_t={class:"photos"},Lt=["onClick"],Ct=["src"],wt={key:0,class:"thumb-overlay"},xt={__name:"PostImages",props:{imgs:Array},emits:["open"],setup(e){return(t,a)=>((0,l.uX)(),(0,l.CE)("div",_t,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.imgs.slice(0,3),((a,o)=>((0,l.uX)(),(0,l.CE)("div",{key:o,class:"thumb",onClick:e=>t.$emit("open",o)},[(0,l.Lk)("img",{src:a},null,8,Ct),2===o&&e.imgs.length>3?((0,l.uX)(),(0,l.CE)("div",wt,[(0,l.Lk)("span",null,"+"+(0,d.v_)(e.imgs.length-3),1)])):(0,l.Q3)("",!0)],8,Lt)))),128))]))}},It=(0,i.A)(xt,[["__scopeId","data-v-08705c32"]]),St=It,Et={__name:"MomentsList",props:{posts:Array,hasMore:Boolean},emits:["load-more","open-modal","toggle-comments"],setup(e,{emit:t}){const a=t;return(t,o)=>((0,l.uX)(),(0,l.CE)(l.FK,null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.posts,(e=>((0,l.uX)(),(0,l.Wv)(yt,{key:e.id,"avatar-url":e.avatar,author:e.author,time:e.time,content:e.content},{images:(0,l.k6)((()=>[(0,l.bF)(St,{imgs:e.imgs,onOpen:t=>a("open-modal",{post:e,idx:t})},null,8,["imgs","onOpen"])])),actions:(0,l.k6)((()=>[(0,l.bF)(pt,{views:e.views,comments:e.cmts.length,onToggleComments:t=>a("toggle-comments",e)},null,8,["views","comments","onToggleComments"])])),comments:(0,l.k6)((()=>[(0,l.RG)(t.$slots,"comments",{post:e})])),_:2},1032,["avatar-url","author","time","content"])))),128)),e.hasMore?((0,l.uX)(),(0,l.Wv)(it,{key:0,onLoad:o[0]||(o[0]=e=>a("load-more"))})):(0,l.Q3)("",!0)],64))}},Mt=Et,At=Mt,Xt={__name:"MomentsPage",setup(e){const t=[{id:1,avatar:"https://placehold.co/40",author:"Alice",time:"刚刚",content:"<p>Hello</p>",imgs:[],views:0,cmts:[]}];return(e,a)=>((0,l.uX)(),(0,l.Wv)(At,{posts:t,hasMore:!1,onOpenModal:()=>{},onToggleComments:()=>{},onLoadMore:()=>{}}))}},Bt=Xt,Ft=Bt,Vt=[{path:"/login",name:"Login",component:lt},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>a.e(899).then(a.bind(a,899))},{path:"/",component:Z,meta:{requiresAuth:!0},children:[{path:"",redirect:"/moments"},{path:"moments",name:"Moments",component:Ft},{path:"albums",name:"Albums",component:we},{path:"editor",name:"Editor",component:Me},{path:"settings",name:"Settings",component:()=>a.e(694).then(a.bind(a,694))},{path:"/settings/:section?",name:"Settings",component:()=>a.e(694).then(a.bind(a,694))}]}],$t=(0,v.aE)({history:(0,v.Bt)(),routes:Vt});$t.beforeEach(((e,t,a)=>{const o=(0,p.k)();if(e.meta.requiresAuth&&!o.currentUser)return a({name:"Login",query:{redirect:e.fullPath}});a()}));const Nt=$t,Wt=(0,n.Ef)(c),Ot=(0,o.Ey)();Wt.use(Nt),Wt.use(Ot),Wt.mount("#app")}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,a),l.exports}a.m=e,(()=>{var e=[];a.O=(t,o,n,l)=>{if(!o){var r=1/0;for(c=0;c<e.length;c++){for(var[o,n,l]=e[c],s=!0,i=0;i<o.length;i++)(!1&l||r>=l)&&Object.keys(a.O).every((e=>a.O[e](o[i])))?o.splice(i--,1):(s=!1,l<r&&(r=l));if(s){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[o,n,l]}})(),(()=>{a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}})(),(()=>{a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,o)=>(a.f[o](e,t),t)),[]))})(),(()=>{a.u=e=>"js/"+e+"."+{694:"74041b43",899:"86836c6a"}[e]+".js"})(),(()=>{a.miniCssF=e=>"css/"+e+"."+{694:"60f7f061",899:"96c2e450"}[e]+".css"})(),(()=>{a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="my-vue-app:";a.l=(o,n,l,r)=>{if(e[o])e[o].push(n);else{var s,i;if(void 0!==l)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+l){s=d;break}}s||(i=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+l),s.src=o),e[o]=[n];var p=(t,a)=>{s.onerror=s.onload=null,clearTimeout(m);var n=e[o];if(delete e[o],s.parentNode&&s.parentNode.removeChild(s),n&&n.forEach((e=>e(a))),t)return t(a)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),i&&document.head.appendChild(s)}}})(),(()=>{a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{a.p="/CapturedMoments/"})(),(()=>{if("undefined"!==typeof document){var e=(e,t,o,n,l)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",a.nc&&(r.nonce=a.nc);var s=a=>{if(r.onerror=r.onload=null,"load"===a.type)n();else{var o=a&&a.type,s=a&&a.target&&a.target.href||t,i=new Error("Loading CSS chunk "+e+" failed.\n("+o+": "+s+")");i.name="ChunkLoadError",i.code="CSS_CHUNK_LOAD_FAILED",i.type=o,i.request=s,r.parentNode&&r.parentNode.removeChild(r),l(i)}};return r.onerror=r.onload=s,r.href=t,o?o.parentNode.insertBefore(r,o.nextSibling):document.head.appendChild(r),r},t=(e,t)=>{for(var a=document.getElementsByTagName("link"),o=0;o<a.length;o++){var n=a[o],l=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(l===e||l===t))return n}var r=document.getElementsByTagName("style");for(o=0;o<r.length;o++){n=r[o],l=n.getAttribute("data-href");if(l===e||l===t)return n}},o=o=>new Promise(((n,l)=>{var r=a.miniCssF(o),s=a.p+r;if(t(r,s))return n();e(o,s,null,n,l)})),n={524:0};a.f.miniCss=(e,t)=>{var a={694:1,899:1};n[e]?t.push(n[e]):0!==n[e]&&a[e]&&t.push(n[e]=o(e).then((()=>{n[e]=0}),(t=>{throw delete n[e],t})))}}})(),(()=>{var e={524:0};a.f.j=(t,o)=>{var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var l=new Promise(((a,o)=>n=e[t]=[a,o]));o.push(n[2]=l);var r=a.p+a.u(t),s=new Error,i=o=>{if(a.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var l=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+l+": "+r+")",s.name="ChunkLoadError",s.type=l,s.request=r,n[1](s)}};a.l(r,i,"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,o)=>{var n,l,[r,s,i]=o,u=0;if(r.some((t=>0!==e[t]))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(i)var c=i(a)}for(t&&t(o);u<r.length;u++)l=r[u],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(c)},o=self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=a.O(void 0,[504],(()=>a(670)));o=a.O(o)})();
//# sourceMappingURL=app.b5c53407.js.map