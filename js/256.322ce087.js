"use strict";(self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[]).push([[256],{256:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Oe});var l=a(641),i=a(33),s=a(751);const o={key:0,class:"mobile-nav"},n={class:"nav-list mobile"},d={key:1,class:"mobile-detail"},c={class:"detail-header"},r={class:"detail-title"},u={class:"settings-content"},p={class:"settings-group setting-group-card"},g={class:"setting-item"},m={key:0,viewBox:"0 0 24 24"},v={key:1,viewBox:"0 0 24 24"},k={class:"setting-item"},h={class:"settings-group setting-group-card"},b={class:"setting-item"},w={class:"setting-item rename-item"},f={class:"setting-item"},L=["src"],S={class:"setting-item"},C={class:"settings-group setting-group-card"},B={class:"setting-item"},y={class:"settings-group setting-group-card"},M={class:"setting-item"},U={class:"settings-group setting-group-card"},x={class:"setting-item"},_={class:"settings-nav"},A={class:"nav-list"},I={class:"settings-content"},F={class:"desktop-detail-header"},$={class:"settings-group setting-group-card"},E={class:"setting-item"},R={key:0,viewBox:"0 0 24 24"},O={key:1,viewBox:"0 0 24 24"},V={class:"setting-item"},W={class:"settings-group setting-group-card"},D={class:"setting-item"},X={class:"setting-item rename-item"},N={class:"setting-item"},G=["src"],P={class:"setting-item"},K={class:"settings-group setting-group-card"},J={class:"setting-item"},z={class:"settings-group setting-group-card"},j={class:"setting-item"},Q={class:"settings-group setting-group-card"},T={class:"setting-item"},H={class:"box",style:{"min-width":"360px","max-width":"480px"}},q={style:{"margin-bottom":"24px"}},Y={style:{"text-align":"right",gap:"8px",display:"flex","justify-content":"flex-end"}},Z={class:"setting-list"},ee={class:"setting-item"},te={class:"upload-btn"},ae={class:"setting-item"},le={class:"setting-item"},ie={class:"setting-item"};function se(e,t,a,se,oe,ne){const de=(0,l.g2)("GhostBtn"),ce=(0,l.g2)("ToggleSwitch"),re=(0,l.g2)("AdminControls"),ue=(0,l.g2)("BaseModal");return(0,l.uX)(),(0,l.CE)("section",{id:"settings",class:(0,i.C4)(["settings-container",{mobile:oe.isMobile}])},[oe.isMobile?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[null===oe.activeSection?((0,l.uX)(),(0,l.CE)("div",o,[(0,l.Lk)("ul",n,[(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"visual"===oe.activeSection}]),onClick:t[0]||(t[0]=e=>ne.toggleSection("visual"))},t[35]||(t[35]=[(0,l.Fv)('<svg class="nav-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M2.5 21.5l2-2 4-4L6 15l-4 4v2.5h2.5z" data-v-21dcc822></path><path d="M6 15l9-9 3 3-9 9" data-v-21dcc822></path><path d="M14.5 5.5l3.5-3.5 3 3-3.5 3.5" data-v-21dcc822></path></svg><span class="nav-label" data-v-21dcc822>视觉 / 界面</span><svg class="chevron-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M9 18l6-6-6-6" data-v-21dcc822></path></svg>',3)]),2),(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"profile"===oe.activeSection}]),onClick:t[1]||(t[1]=e=>ne.toggleSection("profile"))},t[36]||(t[36]=[(0,l.Fv)('<svg class="nav-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z" data-v-21dcc822></path><path d="M4 20v-2c0-2.21 3.58-4 8-4s8 1.79 8 4v2" data-v-21dcc822></path></svg><span class="nav-label" data-v-21dcc822>个人资料</span><svg class="chevron-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M9 18l6-6-6-6" data-v-21dcc822></path></svg>',3)]),2),(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"assistant"===oe.activeSection}]),onClick:t[2]||(t[2]=e=>ne.toggleSection("assistant"))},t[37]||(t[37]=[(0,l.Fv)('<svg class="nav-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10z" data-v-21dcc822></path></svg><span class="nav-label" data-v-21dcc822>交互助手</span><svg class="chevron-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M9 18l6-6-6-6" data-v-21dcc822></path></svg>',3)]),2),(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"publish"===oe.activeSection}]),onClick:t[3]||(t[3]=e=>ne.toggleSection("publish"))},t[38]||(t[38]=[(0,l.Fv)('<svg class="nav-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2" data-v-21dcc822></path><path stroke-linecap="round" stroke-linejoin="round" d="M7 10l5-5m0 0l5 5m-5-5v12" data-v-21dcc822></path></svg><span class="nav-label" data-v-21dcc822>发布 与 上传</span><svg class="chevron-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M9 18l6-6-6-6" data-v-21dcc822></path></svg>',3)]),2),ne.isAdmin?((0,l.uX)(),(0,l.CE)("li",{key:0,class:(0,i.C4)(["nav-item",{active:"admin"===oe.activeSection}]),onClick:t[4]||(t[4]=e=>ne.toggleSection("admin"))},t[39]||(t[39]=[(0,l.Fv)('<svg class="nav-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M9.4 11c.2-.7.6-1.4 1.1-2.1 1-1.4 2.5-2.4 4.2-2.8M12 2a10 10 0 1 0 10 10c0-2-.6-3.9-1.7-5.5" data-v-21dcc822></path></svg><span class="nav-label" data-v-21dcc822>管理员</span><svg class="chevron-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M9 18l6-6-6-6" data-v-21dcc822></path></svg>',3)]),2)):(0,l.Q3)("",!0)])])):((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("header",c,[(0,l.Lk)("button",{class:"back-btn",onClick:t[5]||(t[5]=e=>oe.activeSection=null),"aria-label":"返回"},t[40]||(t[40]=[(0,l.Lk)("svg",{class:"icon-back",viewBox:"0 0 24 24",fill:"none",stroke:"#fff","stroke-width":"2.75","stroke-linecap":"round","stroke-linejoin":"round"},[(0,l.Lk)("path",{d:"M15 18l-6-6 6-6"})],-1)])),(0,l.Lk)("h2",r,(0,i.v_)(ne.sectionTitleMap[oe.activeSection]),1),t[41]||(t[41]=(0,l.Lk)("span",{class:"header-spacer"},null,-1))]),(0,l.Lk)("section",u,[(0,l.bo)((0,l.Lk)("ul",p,[(0,l.Lk)("li",g,[t[44]||(t[44]=(0,l.Lk)("span",null,"主题模式",-1)),(0,l.bF)(de,{disabled:"",title:"已锁定为深色模式"},{default:(0,l.k6)((()=>["light"===a.theme?((0,l.uX)(),(0,l.CE)("svg",m,t[42]||(t[42]=[(0,l.Lk)("circle",{cx:"12",cy:"12",r:"5"},null,-1)]))):((0,l.uX)(),(0,l.CE)("svg",v,t[43]||(t[43]=[(0,l.Lk)("path",{d:"M21 12.8A9 9 0 1111.2 3 7 7 0 0021 12.8z"},null,-1)])))])),_:1})]),(0,l.Lk)("li",k,[t[46]||(t[46]=(0,l.Lk)("span",null,"背景设置",-1)),(0,l.bF)(de,{onClick:t[6]||(t[6]=e=>oe.showBgModal=!0)},{default:(0,l.k6)((()=>t[45]||(t[45]=[(0,l.eW)("打开")]))),_:1})])],512),[[s.aG,"visual"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",h,[(0,l.Lk)("li",b,[t[48]||(t[48]=(0,l.Lk)("span",null,"账号 / 安全",-1)),(0,l.bF)(de,{onClick:t[7]||(t[7]=t=>e.$emit("open-password-modal"))},{default:(0,l.k6)((()=>t[47]||(t[47]=[(0,l.eW)("更改密码")]))),_:1})]),(0,l.Lk)("li",w,[t[49]||(t[49]=(0,l.Lk)("span",null,"我的昵称",-1)),(0,l.bF)(de,{onClick:t[8]||(t[8]=e=>oe.showRenameModal=!0)},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(a.localDisplayName||"设置昵称"),1)])),_:1})]),(0,l.Lk)("li",f,[t[50]||(t[50]=(0,l.Lk)("span",null,"头像：",-1)),(0,l.Lk)("input",{type:"file",accept:"image/*",onChange:t[9]||(t[9]=(...e)=>ne.onAvatarChange&&ne.onAvatarChange(...e))},null,32),oe.userStore&&oe.userStore.avatarMap&&oe.userStore.avatarMap[a.currentUser]?((0,l.uX)(),(0,l.CE)("img",{key:0,src:oe.userStore.avatarMap[a.currentUser],alt:"头像预览",style:{width:"60px",height:"60px","border-radius":"50%","margin-left":"8px"}},null,8,L)):(0,l.Q3)("",!0)]),(0,l.Lk)("li",S,[t[52]||(t[52]=(0,l.Lk)("span",null,"勋章中心",-1)),(0,l.bF)(de,{onClick:t[10]||(t[10]=t=>e.$emit("open-badge-modal"))},{default:(0,l.k6)((()=>t[51]||(t[51]=[(0,l.eW)("更换勋章")]))),_:1})])],512),[[s.aG,"profile"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",C,[(0,l.Lk)("li",B,[t[53]||(t[53]=(0,l.Lk)("span",null,"AI",-1)),(0,l.bF)(ce,{modelValue:a.llmEnabled,"onUpdate:modelValue":t[11]||(t[11]=t=>e.$emit("update:llmEnabled",t))},null,8,["modelValue"])])],512),[[s.aG,"assistant"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",y,[(0,l.Lk)("li",M,[t[54]||(t[54]=(0,l.Lk)("span",null,"图片嵌入正文",-1)),(0,l.bF)(ce,{modelValue:"inline"===a.imageInsertMode,"onUpdate:modelValue":t[12]||(t[12]=t=>e.$emit("update:imageInsertMode",t?"inline":"preview"))},null,8,["modelValue"])])],512),[[s.aG,"publish"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",U,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.allowedUids,(t=>((0,l.uX)(),(0,l.CE)("li",{class:"setting-item",key:t},[(0,l.Lk)("span",null,(0,i.v_)(t),1),(0,l.bF)(re,{uid:t,onResetPassword:t=>e.$emit("reset-password",t),onRemoveAllowedUid:t=>e.$emit("remove-allowed-uid",t),onOpenAdminPwdModal:t=>e.$emit("open-admin-pwd-modal",t)},null,8,["uid","onResetPassword","onRemoveAllowedUid","onOpenAdminPwdModal"])])))),128)),(0,l.Lk)("li",x,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>oe.newAdminUid=e),placeholder:"新 UID",class:"rename-input",style:{background:"#1f1f1f",color:"#e0e0e0",border:"1px solid #444","border-radius":"4px",padding:"6px 8px",width:"60%"}},null,512),[[s.Jo,oe.newAdminUid]]),(0,l.bF)(de,{onClick:ne.emitAddUid},{default:(0,l.k6)((()=>t[55]||(t[55]=[(0,l.eW)("新增")]))),_:1},8,["onClick"])])],512),[[s.aG,"admin"===oe.activeSection&&ne.isAdmin]])])]))],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.Lk)("aside",_,[(0,l.Lk)("ul",A,[(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"visual"===oe.activeSection}]),onClick:t[14]||(t[14]=e=>ne.toggleSection("visual"))},t[56]||(t[56]=[(0,l.Fv)('<svg class="nav-icon" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" data-v-21dcc822><path d="M2.5 21.5l2-2 4-4L6 15l-4 4v2.5h2.5z" data-v-21dcc822></path><path d="M6 15l9-9 3 3-9 9" data-v-21dcc822></path><path d="M14.5 5.5l3.5-3.5 3 3-3.5 3.5" data-v-21dcc822></path></svg><span class="nav-label" data-v-21dcc822>视觉 / 界面</span>',2)]),2),(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"profile"===oe.activeSection}]),onClick:t[15]||(t[15]=e=>ne.toggleSection("profile"))},t[57]||(t[57]=[(0,l.Lk)("svg",{class:"nav-icon",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"}),(0,l.Lk)("path",{d:"M4 20v-2c0-2.21 3.58-4 8-4s8 1.79 8 4v2"})],-1),(0,l.Lk)("span",{class:"nav-label"},"个人资料",-1)]),2),(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"assistant"===oe.activeSection}]),onClick:t[16]||(t[16]=e=>ne.toggleSection("assistant"))},t[58]||(t[58]=[(0,l.Lk)("svg",{class:"nav-icon",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10z"})],-1),(0,l.Lk)("span",{class:"nav-label"},"交互助手",-1)]),2),(0,l.Lk)("li",{class:(0,i.C4)(["nav-item",{active:"publish"===oe.activeSection}]),onClick:t[17]||(t[17]=e=>ne.toggleSection("publish"))},t[59]||(t[59]=[(0,l.Lk)("svg",{class:"nav-icon",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),(0,l.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 10l5-5m0 0l5 5m-5-5v12"})],-1),(0,l.Lk)("span",{class:"nav-label"},"发布 与 上传",-1)]),2),ne.isAdmin?((0,l.uX)(),(0,l.CE)("li",{key:0,class:(0,i.C4)(["nav-item",{active:"admin"===oe.activeSection}]),onClick:t[18]||(t[18]=e=>ne.toggleSection("admin"))},t[60]||(t[60]=[(0,l.Lk)("svg",{class:"nav-icon",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none","stroke-width":"2"},[(0,l.Lk)("path",{d:"M9.4 11c.2-.7.6-1.4 1.1-2.1 1-1.4 2.5-2.4 4.2-2.8M12 2a10 10 0 1 0 10 10c0-2-.6-3.9-1.7-5.5"})],-1),(0,l.Lk)("span",{class:"nav-label"},"管理员",-1)]),2)):(0,l.Q3)("",!0)])]),(0,l.Lk)("section",I,[(0,l.Lk)("header",F,(0,i.v_)(ne.sectionTitleMap[oe.activeSection]),1),(0,l.bo)((0,l.Lk)("ul",$,[(0,l.Lk)("li",E,[t[63]||(t[63]=(0,l.Lk)("span",null,"主题模式",-1)),(0,l.bF)(de,{disabled:"",title:"已锁定为深色模式"},{default:(0,l.k6)((()=>["light"===a.theme?((0,l.uX)(),(0,l.CE)("svg",R,t[61]||(t[61]=[(0,l.Lk)("circle",{cx:"12",cy:"12",r:"5"},null,-1)]))):((0,l.uX)(),(0,l.CE)("svg",O,t[62]||(t[62]=[(0,l.Lk)("path",{d:"M21 12.8A9 9 0 1111.2 3 7 7 0 0021 12.8z"},null,-1)])))])),_:1})]),(0,l.Lk)("li",V,[t[65]||(t[65]=(0,l.Lk)("span",null,"背景设置",-1)),(0,l.bF)(de,{onClick:t[19]||(t[19]=e=>oe.showBgModal=!0)},{default:(0,l.k6)((()=>t[64]||(t[64]=[(0,l.eW)("打开")]))),_:1})])],512),[[s.aG,"visual"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",W,[(0,l.Lk)("li",D,[t[67]||(t[67]=(0,l.Lk)("span",null,"账号 / 安全",-1)),(0,l.bF)(de,{onClick:t[20]||(t[20]=t=>e.$emit("open-password-modal"))},{default:(0,l.k6)((()=>t[66]||(t[66]=[(0,l.eW)("更改密码")]))),_:1})]),(0,l.Lk)("li",X,[t[68]||(t[68]=(0,l.Lk)("span",null,"我的昵称",-1)),(0,l.bF)(de,{onClick:t[21]||(t[21]=e=>oe.showRenameModal=!0)},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(a.localDisplayName||"设置昵称"),1)])),_:1})]),(0,l.Lk)("li",N,[t[69]||(t[69]=(0,l.Lk)("span",null,"头像：",-1)),(0,l.Lk)("input",{type:"file",accept:"image/*",onChange:t[22]||(t[22]=(...e)=>ne.onAvatarChange&&ne.onAvatarChange(...e))},null,32),oe.userStore&&oe.userStore.avatarMap&&oe.userStore.avatarMap[a.currentUser]?((0,l.uX)(),(0,l.CE)("img",{key:0,src:oe.userStore.avatarMap[a.currentUser],alt:"头像预览",style:{width:"60px",height:"60px","border-radius":"50%","margin-left":"8px"}},null,8,G)):(0,l.Q3)("",!0)]),(0,l.Lk)("li",P,[t[71]||(t[71]=(0,l.Lk)("span",null,"勋章中心",-1)),(0,l.bF)(de,{onClick:t[23]||(t[23]=t=>e.$emit("open-badge-modal"))},{default:(0,l.k6)((()=>t[70]||(t[70]=[(0,l.eW)("更换勋章")]))),_:1})])],512),[[s.aG,"profile"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",K,[(0,l.Lk)("li",J,[t[72]||(t[72]=(0,l.Lk)("span",null,"AI",-1)),(0,l.bF)(ce,{modelValue:a.llmEnabled,"onUpdate:modelValue":t[24]||(t[24]=t=>e.$emit("update:llmEnabled",t))},null,8,["modelValue"])])],512),[[s.aG,"assistant"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",z,[(0,l.Lk)("li",j,[t[73]||(t[73]=(0,l.Lk)("span",null,"图片嵌入正文",-1)),(0,l.bF)(ce,{modelValue:"inline"===a.imageInsertMode,"onUpdate:modelValue":t[25]||(t[25]=t=>e.$emit("update:imageInsertMode",t?"inline":"preview"))},null,8,["modelValue"])])],512),[[s.aG,"publish"===oe.activeSection]]),(0,l.bo)((0,l.Lk)("ul",Q,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.allowedUids,(t=>((0,l.uX)(),(0,l.CE)("li",{class:"setting-item",key:t},[(0,l.Lk)("span",null,(0,i.v_)(t),1),(0,l.bF)(re,{uid:t,onResetPassword:t=>e.$emit("reset-password",t),onRemoveAllowedUid:t=>e.$emit("remove-allowed-uid",t),onOpenAdminPwdModal:t=>e.$emit("open-admin-pwd-modal",t)},null,8,["uid","onResetPassword","onRemoveAllowedUid","onOpenAdminPwdModal"])])))),128)),(0,l.Lk)("li",T,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[26]||(t[26]=e=>oe.newAdminUid=e),placeholder:"新 UID",class:"rename-input",style:{background:"#1f1f1f",color:"#e0e0e0",border:"1px solid #444","border-radius":"4px",padding:"6px 8px",width:"60%"}},null,512),[[s.Jo,oe.newAdminUid]]),(0,l.bF)(de,{onClick:ne.emitAddUid},{default:(0,l.k6)((()=>t[74]||(t[74]=[(0,l.eW)("新增")]))),_:1},8,["onClick"])])],512),[[s.aG,"admin"===oe.activeSection&&ne.isAdmin]])])],64)),((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[oe.showRenameModal?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal show",onClick:t[30]||(t[30]=(0,s.D$)((e=>oe.showRenameModal=!1),["self"]))},[(0,l.Lk)("div",H,[(0,l.Lk)("span",{class:"close",onClick:t[27]||(t[27]=e=>oe.showRenameModal=!1)},"×"),t[77]||(t[77]=(0,l.Lk)("h3",{style:{"margin-bottom":"16px"}},"修改昵称",-1)),(0,l.Lk)("div",q,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[28]||(t[28]=e=>oe.renameDraft=e),placeholder:"输入新的 昵称",style:{width:"100%",padding:"8px",border:"1px solid #444","border-radius":"4px",background:"#1f1f1f",color:"#e0e0e0"}},null,512),[[s.Jo,oe.renameDraft]])]),(0,l.Lk)("div",Y,[(0,l.bF)(de,{onClick:t[29]||(t[29]=e=>oe.showRenameModal=!1)},{default:(0,l.k6)((()=>t[75]||(t[75]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(de,{onClick:ne.confirmRename},{default:(0,l.k6)((()=>t[76]||(t[76]=[(0,l.eW)("确定")]))),_:1},8,["onClick"])])])])):(0,l.Q3)("",!0)])),(0,l.bF)(ue,{modelValue:oe.showBgModal,"onUpdate:modelValue":t[34]||(t[34]=e=>oe.showBgModal=e),title:"背景设置",maxWidth:"480px"},{footer:(0,l.k6)((({close:e})=>[(0,l.bF)(de,{onClick:ne.cancelBg},{default:(0,l.k6)((()=>t[84]||(t[84]=[(0,l.eW)("取消")]))),_:1},8,["onClick"]),(0,l.bF)(de,{onClick:ne.confirmBg},{default:(0,l.k6)((()=>t[85]||(t[85]=[(0,l.eW)("完成")]))),_:1},8,["onClick"])])),default:(0,l.k6)((()=>[(0,l.Lk)("ul",Z,[(0,l.Lk)("li",ee,[t[79]||(t[79]=(0,l.Lk)("span",null,"上传背景",-1)),(0,l.Lk)("label",te,[(0,l.bF)(de,null,{default:(0,l.k6)((()=>t[78]||(t[78]=[(0,l.eW)("上传图片")]))),_:1}),(0,l.Lk)("input",{type:"file",accept:"image/*",onChange:t[31]||(t[31]=(...e)=>ne.onBgUpload&&ne.onBgUpload(...e)),style:{display:"none"}},null,32)])]),(0,l.Lk)("li",ae,[t[80]||(t[80]=(0,l.Lk)("span",null,"背景透明度",-1)),(0,l.bo)((0,l.Lk)("input",{type:"range",min:"0",max:"1",step:"0.05","onUpdate:modelValue":t[32]||(t[32]=e=>oe.draftOpacity=e)},null,512),[[s.Jo,oe.draftOpacity,void 0,{number:!0}]])]),(0,l.Lk)("li",le,[t[81]||(t[81]=(0,l.Lk)("span",null,"背景模糊",-1)),(0,l.bo)((0,l.Lk)("input",{type:"range",min:"0",max:"20",step:"1","onUpdate:modelValue":t[33]||(t[33]=e=>oe.draftBlur=e)},null,512),[[s.Jo,oe.draftBlur,void 0,{number:!0}]])]),(0,l.Lk)("li",ie,[t[83]||(t[83]=(0,l.Lk)("span",null,"清除背景",-1)),(0,l.bF)(de,{onClick:ne.clearBg},{default:(0,l.k6)((()=>t[82]||(t[82]=[(0,l.eW)("清除背景")]))),_:1},8,["onClick"])])])])),_:1},8,["modelValue"])],2)}const oe=["disabled"],ne={__name:"GhostBtn",props:{disabled:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:t}){const a=e,i=t;function s(e){a.disabled||i("click",e)}return(t,a)=>((0,l.uX)(),(0,l.CE)("button",{class:"ghost-btn",disabled:e.disabled,onClick:s},[(0,l.RG)(t.$slots,"default")],8,oe))}};var de=a(262);const ce=(0,de.A)(ne,[["__scopeId","data-v-35ff1ca4"]]),re=ce,ue={class:"toggle-switch"},pe=["checked"],ge={__name:"ToggleSwitch",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=t;function i(e){a("update:modelValue",e.target.checked)}return(t,a)=>((0,l.uX)(),(0,l.CE)("label",ue,[(0,l.Lk)("input",{type:"checkbox",checked:e.modelValue,onChange:i},null,40,pe),a[0]||(a[0]=(0,l.Lk)("span",{class:"slider"},null,-1))]))}},me=(0,de.A)(ge,[["__scopeId","data-v-6a800acf"]]),ve=me,ke={key:0,class:"modal-title"},he={class:"modal-body"},be={class:"modal-footer"},we={__name:"BaseModal",props:{modelValue:Boolean,title:String,maxWidth:{type:String,default:"480px"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,o=t,n=(0,l.EW)({get:()=>a.modelValue,set:e=>o("update:modelValue",e)}),d=()=>n.value=!1,c=(0,l.EW)((()=>({width:"90vw",maxWidth:a.maxWidth,padding:"24px",position:"relative"})));return(t,a)=>((0,l.uX)(),(0,l.Wv)(l.Im,{to:"body"},[n.value?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"modal show",onClick:(0,s.D$)(d,["self"])},[(0,l.Lk)("div",{class:"box",style:(0,i.Tr)(c.value)},[(0,l.Lk)("span",{class:"close",onClick:d},"×"),e.title?((0,l.uX)(),(0,l.CE)("h3",ke,(0,i.v_)(e.title),1)):(0,l.Q3)("",!0),(0,l.Lk)("div",he,[(0,l.RG)(t.$slots,"default")]),(0,l.Lk)("div",be,[(0,l.RG)(t.$slots,"footer",{close:d})])],4)])):(0,l.Q3)("",!0)]))}},fe=we,Le=fe,Se={class:"admin-controls"};function Ce(e,t,a,i,s,o){const n=(0,l.g2)("GhostBtn");return(0,l.uX)(),(0,l.CE)("div",Se,[(0,l.bF)(n,{onClick:t[0]||(t[0]=t=>e.$emit("reset-password",a.uid))},{default:(0,l.k6)((()=>t[3]||(t[3]=[(0,l.eW)(" 重置密码 ")]))),_:1}),(0,l.bF)(n,{onClick:t[1]||(t[1]=t=>e.$emit("remove-allowed-uid",a.uid))},{default:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)(" 移除白名单 ")]))),_:1}),(0,l.bF)(n,{onClick:t[2]||(t[2]=t=>e.$emit("open-admin-pwd-modal",a.uid))},{default:(0,l.k6)((()=>t[5]||(t[5]=[(0,l.eW)(" 设定密码 ")]))),_:1})])}const Be={name:"AdminControls",components:{GhostBtn:re},props:{uid:{type:[String,Number],required:!0}}},ye=(0,de.A)(Be,[["render",Ce],["__scopeId","data-v-6be1c388"]]),Me=ye;var Ue=a(468);const xe={name:"SettingsPanel",components:{GhostBtn:re,ToggleSwitch:ve,AdminControls:Me,BaseModal:Le},emits:["update:theme","update:bgSrc","update:bgOpacity","update:bgBlur","update:imageInsertMode","update:llmEnabled","update:localDisplayName","open-password-modal","open-badge-modal","reset-password","add-allowed-uid","remove-allowed-uid","open-admin-pwd-modal"],props:{theme:String,bgOpacity:Number,bgBlur:Number,bgSrc:String,imageInsertMode:String,llmEnabled:Boolean,localDisplayName:String,allowedUids:Array,currentUser:[String,Number],adminUid:[String,Number]},data(){return{activeSection:"visual",isMobile:!1,newAdminUid:"",showRenameModal:!1,renameDraft:this.localDisplayName||"",showBgModal:!1,origBgSrc:this.bgSrc,origOpacity:this.bgOpacity,origBlur:this.bgBlur,draftBgSrc:this.bgSrc,draftOpacity:this.bgOpacity,draftBlur:this.bgBlur,userStore:null}},computed:{isAdmin(){return String(this.currentUser)===String(this.adminUid)},sectionTitleMap(){return{visual:"视觉 / 界面",profile:"个人资料",assistant:"交互助手",publish:"发布 与 上传",admin:"管理员"}}},watch:{showBgModal(e){e&&(this.origBgSrc=this.bgSrc,this.origOpacity=this.bgOpacity,this.origBlur=this.bgBlur,this.draftBgSrc=this.bgSrc,this.draftOpacity=this.bgOpacity,this.draftBlur=this.bgBlur)},draftBgSrc(e){this.showBgModal&&this.$emit("update:bgSrc",e)},draftOpacity(e){this.showBgModal&&this.$emit("update:bgOpacity",e)},draftBlur(e){this.showBgModal&&this.$emit("update:bgBlur",e)}},mounted(){window.addEventListener("resize",this.updateMobile,{passive:!0}),this.updateMobile(),this.userStore=(0,Ue.k)()},beforeUnmount(){window.removeEventListener("resize",this.updateMobile)},methods:{updateMobile(){this.isMobile=window.innerWidth<768,this.isMobile&&""===this.activeSection&&(this.activeSection=null)},toggleSection(e){this.activeSection=e},onAvatarChange(e){const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=()=>{this.userStore.setAvatar(this.currentUser,a.result)},a.readAsDataURL(t)},clearBg(){this.$emit("update:bgSrc",""),this.$emit("update:bgOpacity",1),this.$emit("update:bgBlur",0),this.draftBgSrc="",this.draftOpacity=1,this.draftBlur=0},cancelBg(){this.$emit("update:bgSrc",this.origBgSrc),this.$emit("update:bgOpacity",this.origOpacity),this.$emit("update:bgBlur",this.origBlur),this.showBgModal=!1},confirmBg(){this.showBgModal=!1},confirmRename(){this.$emit("update:localDisplayName",this.renameDraft.trim()),this.showRenameModal=!1},emitAddUid(){const e=(this.newAdminUid||"").trim();e?this.allowedUids.includes(e)?alert(`UID ${e} 已在白名单中`):(this.$emit("add-allowed-uid",e),this.newAdminUid=""):alert("请输入有效 UID")},onBgUpload(e){const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=e=>{this.draftBgSrc=e.target.result},a.readAsDataURL(t)}}},_e=(0,de.A)(xe,[["render",se],["__scopeId","data-v-21dcc822"]]),Ae=_e;var Ie=a(185),Fe=a(953);const $e="217122260",Ee={__name:"SettingsPage",setup(e){const t=[{id:"none",name:"不佩戴"},{id:"best",name:"最好的大佬"},{id:"catgirl",name:"你才是猫娘"}],a=(0,Ue.k)(),i=(0,l.EW)((()=>a.currentUser)),s=(0,Fe.KR)(localStorage.getItem("displayName_"+(i.value||""))||""),o=(0,Fe.KR)(localStorage.getItem("theme")||"dark"),n=(0,Fe.KR)(localStorage.getItem("bgSrc")||""),d=(0,Fe.KR)(parseFloat(localStorage.getItem("bgOpacity")||"0.35")),c=(0,Fe.KR)(parseInt(localStorage.getItem("bgBlur")||"4",10)),r=(0,Fe.KR)(localStorage.getItem("imageInsertMode")||"preview"),u=(0,Fe.KR)(JSON.parse(localStorage.getItem("llmEnabled")||"true")),p=(0,Fe.KR)(localStorage.getItem("wear_"+(i.value||""))||"none"),g=(0,Fe.KR)(JSON.parse(localStorage.getItem("cm_allowedUids")||"[]"));(0,Fe.KR)("");async function m(){if(!i.value)return void alert("当前无登录用户，无法修改密码");const e=i.value,t=`cred_${e}`,a=localStorage.getItem(t);if(!a)return void alert("请先登录并设置密码");const l=window.prompt("请输入旧密码：");if(null===l)return;const{hash:s,salt:o,iter:n}=JSON.parse(a),d=await(0,Ie.wN)(l,o,n);if(d!==s)return void alert("旧密码不正确！");const c=window.prompt("请输入新密码（最少4位）：");if(null===c)return;if(c.length<4)return void alert("新密码长度至少4位！");const r=window.prompt("请再次输入新密码：");if(null===r)return;if(r!==c)return void alert("两次输入的新密码不一致！");const u=await(0,Ie.wN)(c,o,n);localStorage.setItem(t,JSON.stringify({hash:u,salt:o,iter:n})),alert("密码修改成功！")}function v(){const e=t.map((e=>e.id)).join(" / "),a=window.prompt(`请输入要佩戴的勋章 ID（可选 ${e}）：`,p.value);null!==a&&(t.some((e=>e.id===a))?(p.value=a,alert(`已将勋章设置为：${a}`)):alert("无效的勋章 ID"))}function k(e){isAdmin.value?e&&window.confirm(`将清除 UID ${e} 的本地密码，下次登录需重设？`)&&(localStorage.removeItem(`cred_${e}`),localStorage.removeItem(`salt_${e}`),alert(`已清除 UID ${e} 的本地密码`)):alert("只有管理员才能重置密码")}return(0,l.wB)(o,(e=>{document.body.classList.toggle("dark","dark"===e),localStorage.setItem("theme",e)})),(0,l.wB)(n,(e=>{localStorage.setItem("bgSrc",e)})),(0,l.wB)(d,(e=>{localStorage.setItem("bgOpacity",e.toString())})),(0,l.wB)(c,(e=>{localStorage.setItem("bgBlur",e.toString())})),(0,l.wB)(r,(e=>{localStorage.setItem("imageInsertMode",e)})),(0,l.wB)(u,(e=>{localStorage.setItem("llmEnabled",JSON.stringify(e))})),(0,l.wB)(s,(e=>{i.value&&(localStorage.setItem("displayName_"+i.value,e.trim()),a.setDisplayName(i.value,e.trim()))})),(0,l.wB)(p,(e=>{i.value&&(localStorage.setItem("wear_"+i.value,e),a.setBadge(i.value,e))})),(0,l.wB)(g,(e=>{localStorage.setItem("cm_allowedUids",JSON.stringify(e))})),(e,a)=>((0,l.uX)(),(0,l.Wv)(Ae,{theme:o.value,"onUpdate:theme":a[0]||(a[0]=e=>o.value=e),bgSrc:n.value,"onUpdate:bgSrc":a[1]||(a[1]=e=>n.value=e),bgOpacity:d.value,"onUpdate:bgOpacity":a[2]||(a[2]=e=>d.value=e),bgBlur:c.value,"onUpdate:bgBlur":a[3]||(a[3]=e=>c.value=e),imageInsertMode:r.value,"onUpdate:imageInsertMode":a[4]||(a[4]=e=>r.value=e),llmEnabled:u.value,"onUpdate:llmEnabled":a[5]||(a[5]=e=>u.value=e),localDisplayName:s.value,"onUpdate:localDisplayName":a[6]||(a[6]=e=>s.value=e),selectedBadge:p.value,"onUpdate:selectedBadge":a[7]||(a[7]=e=>p.value=e),allowedBadges:t,allowedUids:g.value,currentUser:i.value,adminUid:$e,onOpenPasswordModal:m,onOpenBadgeModal:v,onResetPassword:k,onAddAllowedUid:e.addAllowedUid,onRemoveAllowedUid:e.removeAllowedUid,onOpenAdminPwdModal:e.openAdminPwdModal},null,8,["theme","bgSrc","bgOpacity","bgBlur","imageInsertMode","llmEnabled","localDisplayName","selectedBadge","allowedUids","currentUser","onAddAllowedUid","onRemoveAllowedUid","onOpenAdminPwdModal"]))}},Re=(0,de.A)(Ee,[["__scopeId","data-v-400a22a3"]]),Oe=Re}}]);
//# sourceMappingURL=256.322ce087.js.map